# 开发笔记

## 功能完善计划

### Base 层
1. 内存池管理
   - [ ] 添加统计功能
   - [ ] 优化内存分配策略

2. 异步IO系统
   - [ ] 完善基础框架
   - [ ] 添加性能监控
   - [ ] 实现回调机制

3. 事件循环
   - [ ] 设计核心接口
   - [ ] 实现定时器功能
   - [ ] 添加性能统计

### Database 层
1. 核心功能
   - [ ] 完善KV操作接口
   - [ ] 实现基本事务
   - [ ] 设计MVCC框架

2. 存储引擎
   - [ ] 实现内存表
   - [ ] 设计WAL接口
   - [ ] 规划持久化方案

### Poly 层
1. 存储引擎框架
   - [x] poly_plugin 插件系统
   - [x] poly_memkv 抽象层
   - [ ] poly_sqlite 基础实现
   - [ ] poly_duckdb 扩展实现

2. 功能完善
   - [ ] 插件动态加载
   - [ ] 事务支持
   - [ ] 数据持久化
   - [ ] 性能优化

### Peer 层
1. MemKV服务
   - [x] 基础框架
   - [ ] Memcached协议
   - [ ] 存储引擎管理
   - [ ] 性能监控

## 优化建议

1. 接口合并
   - 统一锁接口（mutex/spinlock）
   - 统一IO接口（同步/异步）
   - 统一协议处理框架

2. 跨层重构
   - 将序列化移至Database层
   - 将通用IO操作移至Base层

## 长期规划

1. 分布式功能
   - [ ] 节点发现
   - [ ] 数据分片
   - [ ] 一致性协议

2. 性能优化
   - [ ] 引入性能基准测试
   - [ ] 优化关键路径
   - [ ] 减少锁竞争 

## 已知问题

- 智能体很容易自己判断后开始自建构建环境
- 智能体容易根据自己的想象构建新文件而不去分析旧有文件
- 容易走神忘记项目的要求和规划

## TODO （有时候会再跳出来，所以不删除，留着一轮轮清）

- 等未来infra完全稳定后，可以考虑封装 libppdbinfra.a （静态库）和 ppdbinfra.lib （动态库）供应我们别的工具包

## 重要说明

### 存储引擎策略
- 默认使用 SQLite:
  - 静态链接到程序中
  - 稳定可靠,易于部署
  - 适合一般使用场景
- 可选使用 DuckDB:
  - 通过插件动态加载
  - 独立升级,避免依赖
  - 适合高级分析场景

### infra 层状态
- infra 层即将封存，已完成基本功能：
  - 网络 IO 多路复用（Windows IOCP / Linux epoll）
  - 基础同步原语（mutex, rwlock, cond）
  - 内存管理
  - 平台抽象
- 暂不实现的功能：
  - 文件异步 IO（需要时可以基于线程池或系统 API 实现）
  - 其他高级特性