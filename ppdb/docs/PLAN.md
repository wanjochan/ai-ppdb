# PPDB 开发计划

## 1. 总体规划

### 1.1 开发阶段
- Phase 1: memkv (当前阶段)
  - 内存KV存储实现
  - 并发控制优化
  - 基础功能完善
- Phase 2: diskv
  - 持久化存储
  - WAL实现
  - SSTable实现
- Phase 3: distrib
  - 分布式功能
  - 集群管理
  - 一致性保证

### 1.2 当前优先级

#### P0 (立即执行)
- [ ] 优化skiplist实现
  - 改进内存布局
  - 优化并发访问
  - 提升查询性能
- [ ] 增强分片功能
  - 完善分片策略
  - 优化数据分布
  - 提升并发性能

#### P1 (次要优先级)
- [ ] 改进并发控制机制
- [ ] 优化内存管理
- [ ] 完善错误处理

#### P2 (待定)
- [ ] 监控指标完善
- [ ] 性能测试框架
- [ ] 文档更新

## 2. 重要决策记录

### 2.1 Memtable刷盘机制推迟
- 决策：memkv阶段不实现memtable刷盘机制
- 原因：
  1. memkv专注于内存数据结构和并发控制
  2. 避免过早引入复杂性
  3. 刷盘机制属于diskv阶段范畴
- 实现计划：
  1. memkv阶段：memtable满时返回错误
  2. diskv阶段：实现完整的刷盘机制
- 影响：简化当前开发，聚焦核心功能

### 2.2 同步机制优化
- 目标：提升并发性能
- 方案：
  1. 使用无锁数据结构
  2. 优化锁粒度
  3. 实现高效的并发控制
- 时间线：
  1. 第一周：实现基础优化
  2. 第二周：性能测试和调优
  3. 第三周：稳定性验证

## 3. 执行计划

### 3.1 当前迭代
1. 代码优化
   - 合并通用功能到common.c
   - 优化核心数据结构
   - 改进错误处理

2. 性能提升
   - 实现无锁操作
   - 优化内存访问
   - 提升并发度

3. 测试完善
   - 单元测试覆盖
   - 性能测试基准
   - 压力测试验证

### 3.2 下一步计划
1. 完成skiplist优化
2. 实现分片增强
3. 准备diskv阶段过渡
