# PPDB 开发计划

> 本文档采用分层架构的方式组织PPDB的开发计划，目的是：
> 1. 清晰展示系统的层次结构：从底层核心组件到上层用户接口
> 2. 明确各层次的职责边界：每层专注于特定的功能领域
> 3. 便于跟踪开发进度：通过分层和模块化的任务列表
> 4. 指导后续开发：保持架构的清晰性和一致性
>
> 文档结构：
> - 第1部分：按照分层架构列出各层组件
> - 第2部分：具体的开发计划和任务
> - 第3部分：项目状态，包括最近更新、当前进展和变更日志
> - 第4部分：文档更新规范和维护原则
>
> 在维护此文档时，请遵循这种分层组织方式，确保架构的清晰性。

## 1. 开发路线

### 第一阶段：通用数据结构层
- [x] 同步原语 (sync)
  - [x] 基础同步类型实现
  - [x] 原子操作封装
  - [x] 基础同步层重构
  - [ ] 分片锁优化
  - [ ] 引用计数管理

- [ ] 统一数据结构框架
  - [ ] skiplist 实现
    - [ ] 内存对齐优化
    - [ ] 原子操作改造
    - [ ] 迭代器实现
  - [ ] memtable 实现
    - [ ] 基于 skiplist
    - [ ] 内存限制
    - [ ] LRU 策略
  - [ ] sharded memtable
    - [ ] 分片策略
    - [ ] 动态扩缩容
    - [ ] 一致性哈希

### 第二阶段（并行开发）

#### A. memkv 产品线
- [ ] 单机版本
  - [ ] 纯内存 KV 存储
  - [ ] 高性能无锁实现
  - [ ] 内存限制和 LRU
  - [ ] 过期时间支持
  
- [ ] 协议兼容层
  - [ ] memcached 协议
    - [ ] 基础命令
    - [ ] 二进制协议
    - [ ] 客户端实现
  - [ ] redis 协议（基础命令）
  - [ ] web 接口
    - [ ] RESTful API
    - [ ] WebSocket 支持

- [ ] 分布式特性
  - [ ] 节点发现
  - [ ] 一致性哈希
  - [ ] 故障检测
  - [ ] 数据分片

#### B. diskv 产品线
- [ ] WAL 实现
  - [ ] 基础写入
  - [ ] 读取恢复
  - [ ] 段管理
  - [ ] 压缩清理

- [ ] KVStore 引擎
  - [ ] 基础操作
  - [ ] 批量操作
  - [ ] 事务支持
  - [ ] 快照隔离

- [ ] SSTable 实现
  - [ ] 文件格式
  - [ ] 索引结构
  - [ ] 压缩算法
  - [ ] 合并策略

### 第三阶段：PPDB 整合
- [ ] 存储引擎整合
  - [ ] memkv + diskv 融合
  - [ ] 混合存储策略
  - [ ] 缓存一致性

- [ ] 分布式支持
  - [ ] 数据分片
  - [ ] 一致性协议
  - [ ] 故障恢复
  - [ ] 负载均衡

- [ ] 运维功能
  - [ ] 监控系统
  - [ ] 性能分析
  - [ ] 运维工具
  - [ ] 备份恢复

### 第四阶段：多模型扩展
- [ ] 关系数据库模型
- [ ] 图数据库模型
- [ ] 列式存储模型
- [ ] 时序数据库模型

## 2. 当前迭代

### 2.1 进行中任务
- [ ] skiplist 优化
  * 内存对齐优化
  * 原子操作改造
  * 性能测试

### 2.2 下一步任务
- [ ] memtable 实现
  * 基于优化后的 skiplist
  * 添加内存限制
  * 实现 LRU 策略

## 3. 构建目标

### memkv
- 构建命令：`build.bat memkv [debug|release]`
- 输出：`memkv.exe`

### diskv
- 构建命令：`build.bat diskv [debug|release]`
- 输出：`diskv.exe`

### ppdb
- 构建命令：`build.bat ppdb [debug|release]`
- 输出：`ppdb.exe`
