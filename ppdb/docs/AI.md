# PPDB 架构设计理解 （由AI Cursor自己写的）

## 整体架构

PPDB采用分层架构设计，自下而上分为三层:

### 1. Infra层 (基础设施层)
- 基于cosmopolitan提供跨平台支持
- 核心功能模块:
  - 内存管理(系统模式和内存池模式)
  - 错误处理
  - 同步原语(互斥、锁、条件变量等)
  - 网络和多路复用(Windows IOCP/Linux epoll)
  - 基本数据结构
- 特点:
  - 不可随意修改
  - 提供统一的跨平台抽象
  - 性能优先

### 2. Poly层 (工具组件层)
- 基于Infra层构建的可重用工具组件
- 限制:
  - 只能调用Infra层接口
  - 不允许直接调用cosmopolitan或libc
- 目标:
  - 提供通用功能组件
  - 提高代码复用性

### 3. Peer层 (产品组件层)
- 具体功能模块实现
- 当前规划:
  - Rinetd: 第一个功能模块，网络转发服务
  - MemKV: 内存KV存储，兼容Memcached协议
  - DiskKV: 持久化存储，兼容Redis协议
  - 分布式集群支持
- 限制:
  - 只能调用Poly层和Infra层接口
  - 不允许直接调用系统API

## 项目目标

1. 分布式数据库系统:
- 高性能内存KV存储
- 可靠的持久化存储
- 分布式集群部署
- 协议兼容性(Memcached/Redis)

2. 跨平台支持:
- 统一的API接口
- 自动适配不同平台
- 最小化平台差异

3. 可扩展性:
- 模块化设计
- 清晰的分层架构
- 标准化的接口

## Rinetd模块

作为第一个功能模块，主要目标:
1. 验证基础架构的可用性
2. 测试Infra层的网络和多路复用功能
3. 提供基础的网络转发服务
4. 为后续模块开发积累经验

## 测试框架

1. 测试策略:
- 采用mock机制进行单元测试
- 提供白盒和黑盒测试
- 支持性能测试和场景测试

2. 测试覆盖:
- 基础功能测试
- 并发压力测试
- 错误处理测试
- 性能基准测试

## 架构优势

1. 层次清晰，职责分明
2. 良好的可扩展性和可维护性
3. 完善的测试支持
4. 强大的跨平台能力
5. 标准化的开发规范 