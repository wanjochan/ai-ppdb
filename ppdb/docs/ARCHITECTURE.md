# PPDB 架构设计

## 1. 目录结构

```
ppdb/
├── include/ppdb/         # 公共头文件
│   ├── ppdb.h           # 主头文件，包含所有公共API
│   └── internal.h       # 内部实现的统一入口
│
├── internal/            # 内部实现
│   ├── base.h          # 基础工具函数
│   └── core.h          # 核心实现
│
├── src/                # 源代码实现
│   ├── base.c         # 基础工具函数实现
│   └── core.c         # 核心功能实现
│
└── test/              # 测试代码
    └── white/         # 白盒测试
```

## 2. 头文件职责

### 2.1 公共头文件

- `ppdb.h`: 定义所有公共API，包括：
  - 错误码
  - 基础类型
  - 数据库操作接口
  - 事务操作接口

- `internal.h`: 内部实现的统一入口，包括：
  - 包含所有内部头文件
  - 定义内部使用的宏
  - 错误检查工具

### 2.2 内部头文件

- `base.h`: 基础工具函数，包括：
  - 内存管理
  - 日志系统
  - 时间工具
  - 字符串操作
  - 原子操作

- `core.h`: 核心实现，包括：
  - 同步原语
  - 内存页管理
  - 事务实现
  - 数据库实现

## 3. 设计原则

1. **简单性**：
   - 保持最小的头文件数量
   - 清晰的层次结构
   - 避免重复定义

2. **封装性**：
   - 公共API与内部实现严格分离
   - 实现细节对用户透明

3. **模块化**：
   - 基础工具与核心功能分离
   - 每个模块职责单一

## 4. 开发规范

1. **头文件组织**：
   - 禁止在 include/ 下创建新的头文件
   - 所有公共API必须在 ppdb.h 中定义
   - 所有内部实现必须在 internal/ 下

2. **依赖关系**：
   - ppdb.h 不依赖任何内部头文件
   - internal.h 是唯一的内部实现入口
   - base.h 不依赖 core.h
   - core.h 可以依赖 base.h

3. **命名规范**：
   - 公共API前缀：ppdb_
   - 内部函数前缀：ppdb_internal_
   - 宏定义前缀：PPDB_

## 5. 注意事项

1. 不要随意添加新的头文件，现有的四个头文件已经足够
2. 新功能应该在现有文件中实现，而不是创建新文件
3. 保持头文件结构的稳定性和清晰性
4. 遵循严格的依赖关系，避免循环依赖
