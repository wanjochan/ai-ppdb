# PPDB 重构计划

## 问题现状

### 1. 代码组织问题
```markdown
- [ ] 测试目录重复
  * test/ 和 tests/ 目录并存
  * 测试用例分散在不同位置
  * 需要统一到 tests/ 目录

- [ ] 数据文件管理
  * WAL文件散落在根目录（*.db.wal）
  * 需要统一移动到 data/ 目录
  * 添加数据目录管理机制

- [ ] 构建产物管理
  * 二进制文件直接在根目录（test.exe、test.dbg）
  * 需要统一移动到 build/ 目录
  * 规范化构建输出路径
```

### 2. 构建系统问题
```markdown
- [ ] 构建脚本整合
  * 合并 build.bat、build_test.bat、build_ppdb.bat
  * 提取共同的构建配置
  * 简化构建命令

- [ ] 跨平台支持
  * 添加 CMake 支持
  * 添加 Linux 构建脚本
  * 统一构建工具链配置

- [ ] 构建流程规范化
  * 统一的版本号管理
  * 构建产物命名规范
  * 增量构建支持
```

### 3. 测试框架增强
```markdown
- [ ] 测试用例组织
  * 统一测试目录结构
  * 分类管理测试用例
  * 添加测试依赖管理

- [ ] 测试覆盖率
  * 添加覆盖率统计工具
  * 设置覆盖率目标
  * 生成覆盖率报告

- [ ] 性能测试
  * 建立性能测试框架
  * 定义性能基准
  * 自动化性能测试
```

### 4. 文档补充
```markdown
- [ ] API文档
  * 每个模块的接口说明
  * 使用示例
  * 错误处理说明

- [ ] 设计文档
  * 架构设计决策
  * 模块依赖关系
  * 关键算法说明

- [ ] 开发指南
  * 开发环境搭建
  * 编码规范
  * 提交规范
```

## 推荐的目录结构

```
ppdb/
├── build/              # 所有构建产物
├── data/              # 数据文件目录
│   └── wal/          # WAL文件存储
├── docs/              # 文档
│   ├── api/          # API文档
│   ├── design/       # 设计文档
│   └── overview/     # 项目概览文档
├── scripts/           # 构建和工具脚本
│   ├── build/        # 构建脚本
│   └── tools/        # 开发工具
├── src/               # 源代码
│   ├── common/       # 通用组件
│   ├── kvstore/      # KV存储引擎
│   └── raft/         # Raft实现(预留)
└── tests/             # 测试
    ├── unit/         # 单元测试
    ├── integration/  # 集成测试
    └── performance/  # 性能测试
```

## 执行建议

1. 优先级排序
   - P0: 目录结构调整和构建系统统一
   - P1: 测试框架增强
   - P2: 文档补充

2. 执行步骤
   - 先创建新的目录结构
   - 逐步迁移现有文件
   - 确保每次迁移后测试通过
   - 同步更新文档

3. 质量保证
   - 每个重构步骤都要有测试覆盖
   - 保持向后兼容
   - 记录所有重要变更

## 注意事项

1. 重构过程中确保：
   - 不影响现有功能
   - 所有测试持续通过
   - 构建过程正常工作

2. 文档同步：
   - 及时更新相关文档
   - 标注重要的变更
   - 记录决策原因

3. 沟通协作：
   - 在重构前通知其他助理
   - 重构完成后更新TODO.md的状态
   - 及时响应问题反馈 