# PPDB 命令行接?
PPDB 提供了一个功能完整的命令行工具，用于管理和操作数据库。本文档详细介绍了命令行工具的使用方法?
## 性能特点

- **并发模式**：支持有锁和无锁两种模式，无锁模式在高并发场景下性能更好
- **内存管理**：使用跳表和分片技术，优化内存使用和访问性能
- **持久?*：采?WAL（预写日志）确保数据可靠性，支持崩溃恢复
- **文件组织**：使用分段日志文件，避免单个文件过大，便于管理和压缩

## 系统要求

### 硬件要求
- CPU: 1核心及以?- 内存: 最?256MB，推?1GB 以上
- 磁盘: 最?1GB 可用空间，推?SSD

### 软件要求
- 操作系统: Linux、macOS、Windows
- 依赖? 无额外依赖，静态链接所有库

## 限制说明

### 键值限?- 键最大长? 32KB
- 值最大长? 64MB
- 单条记录最大总大? 64MB + 32KB

### 存储限制
- 单个数据目录最大大? 理论上无限制，取决于文件系统
- 单个 MemTable 最大大? 可配置，默认 1MB
- 单个 WAL 段文件大? 可配置，默认 1MB

### 并发限制
- 最大并发连接数: 无硬性限?- 最大并发写入数: 无硬性限?- 最大并发读取数: 无硬性限?
## 性能优化建议

### 1. 写入性能优化
- 使用无锁模式（`--mode lockfree`?- 增大 MemTable 大小（`--memtable-size`?- 使用 SSD 存储
- 批量写入（计划中?
### 2. 读取性能优化
- 合理设置 L0 文件大小
- 使用 SSD 存储
- 预热数据（多次访问）
- 避免频繁重启

### 3. 内存使用优化
- 根据实际负载调整 MemTable 大小
- 定期触发压缩（计划中?- 监控内存使用情况

## 监控和维?
### 1. 日志监控
- 错误日志: 记录系统错误和异?- 操作日志: 记录关键操作
- 性能日志: 记录性能指标（计划中?
### 2. 数据维护
- 定期备份数据目录
- 检查磁盘空间使?- 监控文件数量
- 清理过期数据（计划中?
### 3. 性能监控
- 使用 `stats` 命令查看基本统计
- 监控系统资源使用
- 跟踪响应时间（计划中?- 观察并发性能（计划中?
## 故障处理

### 1. 常见问题
- 启动失败
  - 检查数据目录权?  - 确认端口未被占用
  - 验证配置参数
- 写入失败
  - 检查磁盘空?  - 确认 MemTable 未满
  - 验证文件权限
- 读取失败
  - 确认键存?  - 检查数据文件完整?  - 验证数据目录正确

### 2. 恢复流程
- 系统崩溃
  1. 保留现场日志
  2. 重启服务
  3. 等待 WAL 恢复完成
- 数据损坏
  1. 停止服务
  2. 备份数据目录
  3. 使用备份恢复
  4. 重启服务

## 版本说明

### 当前版本 (0.1.0)
- 基本?KV 存储功能
- WAL 日志支持
- 命令行工?- 有锁/无锁模式

### 计划功能
- HTTP API 服务
- 批量操作支持
- 数据压缩
- 性能监控
- 备份恢复工具

## 参考资?
- [项目 GitHub 仓库](https://github.com/your-username/ppdb)
- [详细设计文档](../design/)
- [性能测试报告](../test/PERFORMANCE.md)
- [常见问题解答](../ops/FAQ.md)

## 基本用法

```bash
ppdb [选项] <命令> [参数...]
```

## 全局选项

| 选项 | 说明 | 默认?|
|------|------|--------|
| `--mode <locked\|lockfree>` | 运行模式 | locked |
| `--dir <path>` | 数据目录路径 | db |
| `--memtable-size <bytes>` | 内存表大?| 1MB |
| `--l0-size <bytes>` | L0层文件大?| 1MB |
| `--help` | 显示帮助信息 | - |

## 命令

### put - 存储键值对

```bash
ppdb put <key> <value>
```

示例?```bash
# 存储简单的键值对
ppdb put mykey myvalue

# 使用无锁模式存储
ppdb --mode lockfree put mykey myvalue

# 指定数据目录
ppdb --dir /path/to/db put mykey myvalue
```

### get - 获取键对应的?
```bash
ppdb get <key>
```

示例?```bash
# 获取键的?ppdb get mykey

# 从指定目录获?ppdb --dir /path/to/db get mykey
```

### delete - 删除键值对

```bash
ppdb delete <key>
```

示例?```bash
# 删除键值对
ppdb delete mykey

# 使用无锁模式删除
ppdb --mode lockfree delete mykey
```

### stats - 显示数据库统计信?
```bash
ppdb stats
```

输出示例?```
数据库统计信?
- 运行模式: 加锁
- 数据目录: db
- MemTable 大小限制: 1048576 bytes
- L0 文件大小限制: 1048576 bytes
```

### server - 启动 HTTP API 服务器（待实现）

```bash
ppdb server
```

## 配置示例

### 1. 基本配置

```bash
# 使用默认配置
ppdb put key1 value1

# 显示帮助信息
ppdb --help
```

### 2. 性能优化配置

```bash
# 使用更大的内存表?L0 文件大小
ppdb --memtable-size 67108864 --l0-size 268435456 put key1 value1
```

### 3. 无锁模式配置

```bash
# 使用无锁模式运行
ppdb --mode lockfree --memtable-size 67108864 put key1 value1
```

## 错误处理

命令行工具会返回以下错误码：
- 0: 成功
- 1: 错误（具体错误信息会显示在控制台?
常见错误信息?- "错误: put 命令需?key ?value 参数"
- "错误: get 命令需?key 参数"
- "错误: delete 命令需?key 参数"
- "错误: 未找到键: xxx"
- "错误: 存储键值对失败: xxx"

## 最佳实?
1. 选择合适的运行模式
   - 单线程场景使?`locked` 模式
   - 高并发场景使?`lockfree` 模式

2. 配置合适的内存表大?   - 根据数据量和内存大小调整
   - 建议设置为可用内存的 1/4 ?1/2

3. 配置合适的 L0 文件大小
   - 根据磁盘性能和数据访问模式调?   - 建议设置为内存表大小?4-8 ?
4. 数据目录管理
   - 使用专用目录存储数据
   - 确保目录有足够的磁盘空间
   - 定期备份数据目录

## 环境变量支持（计划中?
未来版本将支持通过环境变量配置?- `PPDB_MODE`: 运行模式
- `PPDB_DIR`: 数据目录
- `PPDB_MEMTABLE_SIZE`: 内存表大?- `PPDB_L0_SIZE`: L0 文件大小 